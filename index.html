<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Giddyup</title>
  <meta name="description" content="Giddyup â€” personal health dashboard (weekly ring, activity log, sleep, recovery, AI coach placeholders).">
  <!-- Minimal, app-like styling -->
  <style>
    :root {
      --bg: #0B0F1A;
      --bg2: #0E1424;
      --card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.12);
      --text: #EAF2FF;
      --muted: #A9B4C7;
      --accent: #00F5D4;
      --accent2: #12B3E6;
      --warn: #FFD166;
      --alert: #EF476F;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: linear-gradient(180deg,var(--bg), var(--bg2));
      color: var(--text);
    }
    header {
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(11,15,26,0.95), rgba(14,20,36,0.85));
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--border);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 10;
    }
    header h1 { font-size: 18px; margin: 0; letter-spacing: 0.4px; }
    .pill {
      margin-left: auto;
      font-size: 12px;
      color: #111;
      background: var(--accent);
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 700;
    }
    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      display: grid;
      gap: 16px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    @media (min-width: 720px) {
      .row { grid-template-columns: 1fr 1fr; }
    }
    .ring {
      position: relative;
      width: 240px; height: 240px; margin: 0 auto;
    }
    .ring .track {
      position: absolute; inset: 0; border-radius: 50%;
      background: conic-gradient(rgba(255,255,255,0.09) 0 360deg);
      box-shadow: inset 0 0 30px rgba(0,0,0,0.4);
    }
    .ring .fill {
      position: absolute; inset: 0; border-radius: 50%;
      -webkit-mask: radial-gradient(circle at center, transparent 74px, black 76px);
              mask: radial-gradient(circle at center, transparent 74px, black 76px);
      background: conic-gradient(var(--accent) 0 250deg, transparent 250deg 360deg);
      filter: drop-shadow(0 2px 8px rgba(0,245,212,0.35));
    }
    .ring .center {
      position: absolute; inset: 0; display: grid; place-items: center; text-align: center;
    }
    .ring .big { font-size: 40px; font-weight: 800; letter-spacing: 0.4px; }
    .muted { color: var(--muted); font-size: 12px; letter-spacing: 0.5px; }
    nav {
      position: sticky;
      bottom: 0;
      display: grid;
      grid-template-columns: repeat(6,1fr);
      gap: 8px;
      padding: 10px;
      background: linear-gradient(0deg, rgba(11,15,26,0.95), rgba(11,15,26,0.65));
      backdrop-filter: blur(6px);
      border-top: 1px solid var(--border);
      z-index: 10;
    }
    nav button {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 8px;
      font-size: 12px;
      cursor: pointer;
    }
    nav button.active { outline: 2px solid var(--accent); }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
    input, select, textarea {
      width: 100%; padding: 10px; border-radius: 10px;
      border: 1px solid var(--border); background: rgba(255,255,255,0.04);
      color: var(--text);
    }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { border-bottom: 1px solid var(--border); padding: 10px; text-align: left; }
    .tag { display:inline-block; padding: 3px 8px; border-radius: 999px; font-size: 11px; background: rgba(255,255,255,0.08); border:1px solid var(--border); margin-right:6px; }
  </style>
</head>
<body>
  <header>
    <h1>Giddyup</h1>
    <span class="pill">Phase 1.5</span>
  </header>

  <main id="app"></main>

  <nav id="tabs"></nav>

  <!-- React via CDN (no build) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- App Code (JSX compiled by Babel in browser) -->
  <script type="text/babel">
    const { useState, useEffect } = React;

    function Ring({ pct = 0.72, label = "weekly recovery" }) {
      const deg = Math.max(0, Math.min(1, pct)) * 360;
      return (
        <div className="ring" role="img" aria-label={label}>
          <div className="track" />
          <div className="fill" style={{ background: \`conic-gradient(var(--accent) 0 \${deg}deg, transparent \${deg}deg 360deg)\` }} />
          <div className="center">
            <div className="big">{Math.round(pct*100)}%</div>
            <div className="muted">{label}</div>
          </div>
        </div>
      );
    }

    function Dashboard() {
      return (
        <section className="card">
          <h2 style={{marginTop:0}}>Dashboard</h2>
          <div className="row">
            <div className="card">
              <h3 style={{marginTop:0}}>Readiness</h3>
              <Ring pct={0.72} label="weekly recovery" />
              <div className="grid2" style={{marginTop:12}}>
                <div><span className="muted">HRV</span><div>56 ms</div></div>
                <div><span className="muted">RHR</span><div>58 bpm</div></div>
                <div><span className="muted">Sleep</span><div>7h 28m</div></div>
                <div><span className="muted">Strain</span><div>12.3</div></div>
              </div>
            </div>
            <div className="card">
              <h3 style={{marginTop:0}}>AI Coach (placeholder)</h3>
              <p className="muted">Once OpenRouter is added, this will show personalized guidance based on the last 7 days.</p>
              <ul>
                <li>Today: Train light to moderate.</li>
                <li>Focus: Sleep consistency & hydration.</li>
              </ul>
              <div>
                <span className="tag">sleep</span>
                <span className="tag">recovery</span>
                <span className="tag">strain</span>
              </div>
            </div>
          </div>
        </section>
      );
    }

    function Activity() {
      const [form, setForm] = useState({ type: "Walking", minutes: 30, notes: "" });
      const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem("gx_logs")||"[]"));

      function addLog(e) {
        e.preventDefault();
        const entry = { ...form, id: Date.now(), date: new Date().toISOString().slice(0,10) };
        const next = [entry, ...logs];
        setLogs(next);
        localStorage.setItem("gx_logs", JSON.stringify(next));
        setForm({ type: "Walking", minutes: 30, notes: "" });
      }

      return (
        <section className="card">
          <h2 style={{marginTop:0}}>Activity Log</h2>
          <form onSubmit={addLog} className="row">
            <div className="card">
              <label>Type</label>
              <select value={form.type} onChange={e => setForm({...form, type: e.target.value})}>
                <option>Walking</option>
                <option>Hiking</option>
                <option>Padel</option>
                <option>Pickleball</option>
                <option>Strength</option>
                <option>Other</option>
              </select>
              <label style={{marginTop:10}}>Minutes</label>
              <input type="number" min="1" value={form.minutes} onChange={e => setForm({...form, minutes: Number(e.target.value)})} />
              <label style={{marginTop:10}}>Notes</label>
              <textarea rows="3" value={form.notes} onChange={e => setForm({...form, notes: e.target.value})}></textarea>
              <button style={{marginTop:10}}>Add Activity</button>
            </div>
            <div className="card">
              <h3 style={{marginTop:0}}>Recent</h3>
              <table>
                <thead><tr><th>Date</th><th>Type</th><th>Min</th><th>Notes</th></tr></thead>
                <tbody>
                  {logs.map(l => (
                    <tr key={l.id}><td>{l.date}</td><td>{l.type}</td><td>{l.minutes}</td><td>{l.notes}</td></tr>
                  ))}
                </tbody>
              </table>
            </div>
          </form>
        </section>
      );
    }

    function Sleep() {
      return (
        <section className="card">
          <h2 style={{marginTop:0}}>Sleep</h2>
          <p className="muted">Placeholder. Will parse Health Connect export to show duration, efficiency, and stages.</p>
          <div className="grid2">
            <div className="card"><span className="muted">Last night</span><div>7h 31m</div></div>
            <div className="card"><span className="muted">7-day avg</span><div>7h 12m</div></div>
          </div>
        </section>
      );
    }

    function Recovery() {
      return (
        <section className="card">
          <h2 style={{marginTop:0}}>Recovery</h2>
          <div className="grid2">
            <div className="card"><span className="muted">HRV</span><div>56 ms</div></div>
            <div className="card"><span className="muted">RHR</span><div>58 bpm</div></div>
            <div className="card"><span className="muted">Strain (yday)</span><div>12.3</div></div>
            <div className="card"><span className="muted">Sleep score</span><div>84</div></div>
          </div>
          <p className="muted" style={{marginTop:10}}>Recovery Score (demo): 72 â€” Weâ€™ll compute from HRV, RHR, Sleep, Strain.</p>
        </section>
      );
    }

    function Importer() {
      const [fileName, setFileName] = useState("");
      function onFile(e) {
        const file = e.target.files?.[0];
        if (!file) return;
        setFileName(file.name);
        const reader = new FileReader();
        reader.onload = () => {
          // For now, just store raw text for later parsing
          localStorage.setItem("gx_health_raw", reader.result);
          alert("Imported file text saved locally. Weâ€™ll parse it in the next step.");
        };
        reader.readAsText(file);
      }
      return (
        <section className="card">
          <h2 style={{marginTop:0}}>Google Drive / Health Connect Import</h2>
          <p className="muted">Export Health Connect to CSV/JSON â†’ download to your device â†’ choose file here.</p>
          <input type="file" accept=".csv,.json,.txt" onChange={onFile} />
          {fileName && <p>Selected: {fileName}</p>}
        </section>
      );
    }

    function Profile() {
      const [profile, setProfile] = useState(() => JSON.parse(localStorage.getItem("gx_profile")||"{}"));
      function update(k,v){ const next = {...profile, [k]: v}; setProfile(next); localStorage.setItem("gx_profile", JSON.stringify(next)); }
      return (
        <section className="card">
          <h2 style={{marginTop:0}}>Profile & Settings</h2>
          <div className="grid2">
            <div className="card">
              <label>Age</label><input type="number" value={profile.age||""} onChange={e => update("age", Number(e.target.value))}/>
              <label style={{marginTop:10}}>Height (in)</label><input type="number" value={profile.heightIn||""} onChange={e => update("heightIn", Number(e.target.value))}/>
              <label style={{marginTop:10}}>Weight (lb)</label><input type="number" value={profile.weightLb||""} onChange={e => update("weightLb", Number(e.target.value))}/>
            </div>
            <div className="card">
              <span className="muted">Data</span>
              <div style={{marginTop:6}}>
                <button onClick={() => { localStorage.clear(); alert("Local data cleared"); }}>Clear local data</button>
              </div>
              <div style={{marginTop:6}}>
                <button onClick={() => {
                  const dump = {
                    profile: JSON.parse(localStorage.getItem("gx_profile")||"{}"),
                    logs: JSON.parse(localStorage.getItem("gx_logs")||"[]"),
                    raw: localStorage.getItem("gx_health_raw")||""
                  };
                  const blob = new Blob([JSON.stringify(dump,null,2)], {type:"application/json"});
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement("a");
                  a.href = url; a.download = "giddyup_export.json"; a.click();
                }}>Export local data</button>
              </div>
            </div>
          </div>
        </section>
      );
    }

    const TABS = [
      { key: "dashboard", label: "Dashboard", comp: Dashboard },
      { key: "activity", label: "Activity", comp: Activity },
      { key: "sleep", label: "Sleep", comp: Sleep },
      { key: "recovery", label: "Recovery", comp: Recovery },
      { key: "import", label: "Import", comp: Importer },
      { key: "profile", label: "Profile", comp: Profile },
    ];

    function App() {
      const [tab, setTab] = useState(localStorage.getItem("gx_tab") || "dashboard");
      const Active = TABS.find(t => t.key === tab)?.comp || Dashboard;
      useEffect(() => { localStorage.setItem("gx_tab", tab); }, [tab]);
      return (
        <>
          <Active />
          <div style={{height:60}}></div>
          <div id="navMount"></div>
        </>
      );
    }

    function Tabs({ tab, setTab }) {
      return (
        <>
          {TABS.map(t => (
            <button key={t.key} className={t.key===tab ? "active" : ""} onClick={() => setTab(t.key)}>
              {t.label}
            </button>
          ))}
        </>
      );
    }

    // Mount app
    const root = ReactDOM.createRoot(document.getElementById("app"));
    root.render(<App />);

    // Mount tabs into fixed nav
    function mountTabs() {
      const tabRoot = document.getElementById("tabs");
      const { useState, useEffect } = React;
      function NavShell() {
        const [tab, setTab] = React.useState(localStorage.getItem("gx_tab") || "dashboard");
        useEffect(() => {
          localStorage.setItem("gx_tab", tab);
          // Force main app to re-render by remounting
          const root = ReactDOM.createRoot(document.getElementById("app"));
          const Active = TABS.find(t => t.key === tab)?.comp || Dashboard;
          root.render(<><Active /><div style={{height:60}}></div><div id="navMount"></div></>);
        }, [tab]);
        return <Tabs tab={tab} setTab={setTab} />;
      }
      const navRoot = ReactDOM.createRoot(tabRoot);
      navRoot.render(<NavShell />);
    }
    mountTabs();
  </script>
</body>
</html>
